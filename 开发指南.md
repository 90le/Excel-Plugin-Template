# BasePlugin å¿«é€Ÿå¼€å‘æŒ‡å—

## ğŸš€ 5åˆ†é’Ÿå¿«é€Ÿå¼€å§‹

### ç¬¬ä¸€æ­¥ï¼šè·å–æ¨¡æ¿
1. å°† BasePlugin æ¨¡æ¿å¤åˆ¶åˆ°æ‚¨çš„å¼€å‘ç›®å½•
2. é‡å‘½åæ–‡ä»¶å¤¹ä¸ºæ‚¨çš„æ’ä»¶åç§°ï¼ˆå¦‚ï¼šMyExcelPluginï¼‰

### ç¬¬äºŒæ­¥ï¼šé‡å‘½åå’Œé…ç½®
1. **é‡å‘½åé¡¹ç›®æ–‡ä»¶**
   - `BasePlugin.csproj` â†’ `MyExcelPlugin.csproj`
   - `BasePlugin.cs` â†’ `MyExcelPlugin.cs`

2. **ä¿®æ”¹å‘½åç©ºé—´**
   - å°†æ‰€æœ‰æ–‡ä»¶ä¸­çš„ `BasePlugin` æ›¿æ¢ä¸º `MyExcelPlugin`

3. **æ›´æ–°é…ç½®ä¿¡æ¯**
   - ä¿®æ”¹ `manifest.json` ä¸­çš„æ’ä»¶ä¿¡æ¯
   - æ›´æ–° `MyExcelPlugin.cs` ä¸­çš„æ’ä»¶å±æ€§

### ç¬¬ä¸‰æ­¥ï¼šæ·»åŠ æ‚¨çš„ç¬¬ä¸€ä¸ªåŠŸèƒ½
```csharp
// åœ¨ Features/SampleFeatures.cs ä¸­æ·»åŠ æ–°åŠŸèƒ½
new PluginFeature
{
    Id = "my_first_feature",
    Name = "æˆ‘çš„ç¬¬ä¸€ä¸ªåŠŸèƒ½",
    Description = "è¿™æ˜¯æˆ‘å¼€å‘çš„ç¬¬ä¸€ä¸ªExcelåŠŸèƒ½",
    Category = "æˆ‘çš„åŠŸèƒ½",
    Tags = new List<string> { "è‡ªå®šä¹‰", "ç¤ºä¾‹" },
    ImageMso = "FileNew",
    Action = MyFirstFeature
}

private void MyFirstFeature()
{
    ShowMessage("æ­å–œï¼æ‚¨çš„ç¬¬ä¸€ä¸ªExcelæ’ä»¶åŠŸèƒ½æˆåŠŸè¿è¡Œï¼");
}
```

### ç¬¬å››æ­¥ï¼šæµ‹è¯•è¿è¡Œ
1. æŒ‰ F5 å¯åŠ¨è°ƒè¯•
2. Excel ä¼šè‡ªåŠ¨æ‰“å¼€å¹¶åŠ è½½æ‚¨çš„æ’ä»¶
3. åœ¨åŠŸèƒ½åŒºæ‰¾åˆ°æ‚¨çš„æ’ä»¶æŒ‰é’®å¹¶æµ‹è¯•

## ğŸ“ æ¨èçš„å¼€å‘æµç¨‹

### 1. è§„åˆ’åŠŸèƒ½æ¨¡å—
```
MyExcelPlugin/
â”œâ”€â”€ Features/
â”‚   â”œâ”€â”€ DataFeatures.cs      # æ•°æ®å¤„ç†åŠŸèƒ½
â”‚   â”œâ”€â”€ FormatFeatures.cs    # æ ¼å¼åŒ–åŠŸèƒ½
â”‚   â””â”€â”€ ChartFeatures.cs     # å›¾è¡¨åŠŸèƒ½
```

### 2. åŠŸèƒ½å¼€å‘æ¨¡æ¿
```csharp
public class DataFeatures
{
    private Excel.Application _excelApp;
    
    public DataFeatures(Excel.Application excelApp)
    {
        _excelApp = excelApp;
    }
    
    public List<PluginFeature> GetFeatures()
    {
        return new List<PluginFeature>
        {
            CreateFeature("sort_data", "æ•°æ®æ’åº", "å¯¹é€‰ä¸­æ•°æ®è¿›è¡Œæ’åº", SortData),
            CreateFeature("filter_data", "æ•°æ®ç­›é€‰", "ç­›é€‰æ•°æ®", FilterData)
        };
    }
    
    private PluginFeature CreateFeature(string id, string name, string desc, Action action)
    {
        return new PluginFeature
        {
            Id = id,
            Name = name,
            Description = desc,
            Category = "æ•°æ®å¤„ç†",
            Tags = new List<string> { "æ•°æ®", "å¤„ç†" },
            ImageMso = "DatabaseSortDescending",
            Action = action
        };
    }
    
    private void SortData()
    {
        try
        {
            var selection = _excelApp?.Selection as Excel.Range;
            if (selection == null)
            {
                ShowMessage("è¯·å…ˆé€‰æ‹©è¦æ’åºçš„æ•°æ®åŒºåŸŸ");
                return;
            }
            
            // æ’åºé€»è¾‘
            selection.Sort(selection.Columns[1]);
            ShowMessage("æ•°æ®æ’åºå®Œæˆ");
        }
        catch (Exception ex)
        {
            ShowError($"æ’åºå¤±è´¥: {ex.Message}");
        }
    }
}
```

### 3. æ³¨å†ŒåŠŸèƒ½æ¨¡å—
```csharp
// åœ¨ MyExcelPlugin.cs ä¸­æ³¨å†Œ
private DataFeatures _dataFeatures;
private FormatFeatures _formatFeatures;

public void Initialize()
{
    _excelApp = HostApplication.Instance.ExcelApplication;
    
    // æ³¨å†ŒåŠŸèƒ½æ¨¡å—
    _dataFeatures = new DataFeatures(_excelApp);
    _formatFeatures = new FormatFeatures(_excelApp);
    
    _isInitialized = true;
}

private List<PluginFeature> GetAllFeatures()
{
    var allFeatures = new List<PluginFeature>();
    
    if (_dataFeatures != null)
        allFeatures.AddRange(_dataFeatures.GetFeatures());
    if (_formatFeatures != null)
        allFeatures.AddRange(_formatFeatures.GetFeatures());
    
    return allFeatures;
}
```

## ğŸ¨ ç•Œé¢å¼€å‘

### WinForms å¿«é€Ÿå¯¹è¯æ¡†
```csharp
private void ShowInputDialog()
{
    using (var form = new Form())
    {
        form.Text = "è¾“å…¥å¯¹è¯æ¡†";
        form.Size = new Size(300, 150);
        form.StartPosition = FormStartPosition.CenterParent;
        
        var textBox = new TextBox { Width = 200, Top = 20, Left = 50 };
        var btnOK = new Button { Text = "ç¡®å®š", Top = 60, Left = 100 };
        
        btnOK.Click += (s, e) => {
            var input = textBox.Text;
            // å¤„ç†è¾“å…¥
            form.DialogResult = DialogResult.OK;
        };
        
        form.Controls.AddRange(new Control[] { textBox, btnOK });
        form.ShowDialog();
    }
}
```

### WPF å¤æ‚ç•Œé¢
```csharp
private void ShowWPFDialog()
{
    var window = new Window
    {
        Title = "æ•°æ®å¤„ç†",
        Width = 500,
        Height = 400,
        WindowStartupLocation = WindowStartupLocation.CenterOwner
    };
    
    // è®¾ç½®å†…å®¹æˆ–åŠ è½½XAMLè§†å›¾
    window.Content = new DataProcessingView();
    window.ShowDialog();
}
```

## ğŸ”§ å¸¸ç”¨Excelæ“ä½œä»£ç ç‰‡æ®µ

### å•å…ƒæ ¼æ“ä½œ
```csharp
// è¯»å–å•å…ƒæ ¼å€¼
var cellValue = _excelApp.ActiveCell.Value;

// è®¾ç½®å•å…ƒæ ¼å€¼
_excelApp.ActiveCell.Value = "æ–°å€¼";

// è®¾ç½®å•å…ƒæ ¼å…¬å¼
_excelApp.ActiveCell.Formula = "=SUM(A1:A10)";

// è®¾ç½®å•å…ƒæ ¼æ ¼å¼
_excelApp.ActiveCell.NumberFormat = "0.00";
```

### åŒºåŸŸæ“ä½œ
```csharp
// è·å–é€‰ä¸­åŒºåŸŸ
var range = _excelApp.Selection as Excel.Range;

// æ‰¹é‡è®¾ç½®å€¼
range.Value = new object[,] { {"A", "B"}, {"1", "2"} };

// è®¾ç½®èƒŒæ™¯è‰²
range.Interior.Color = ColorTranslator.ToOle(Color.Yellow);

// è®¾ç½®è¾¹æ¡†
range.Borders.LineStyle = Excel.XlLineStyle.xlContinuous;
```

### å·¥ä½œè¡¨æ“ä½œ
```csharp
// æ·»åŠ æ–°å·¥ä½œè¡¨
var newSheet = _excelApp.ActiveWorkbook.Worksheets.Add();
newSheet.Name = "æ–°å·¥ä½œè¡¨";

// å¤åˆ¶å·¥ä½œè¡¨
_excelApp.ActiveSheet.Copy(_excelApp.ActiveSheet);

// åˆ é™¤å·¥ä½œè¡¨
_excelApp.ActiveSheet.Delete();
```

## ğŸ”„ æ’ä»¶è‡ªåŠ¨æ›´æ–°é…ç½®

### å¿«é€Ÿé…ç½®æ›´æ–°åŠŸèƒ½

1. **ä¿®æ”¹ manifest.json æ·»åŠ æ›´æ–°é…ç½®**ï¼š
```json
{
  "updateInfo": {
    "updateUrl": "https://yourdomain.com/api/plugins/update-check",
    "downloadUrl": "https://yourdomain.com/api/plugins/download",
    "checkIntervalHours": 24,
    "autoCheck": true,
    "supportedUpdateModes": ["full"],
    "backupBeforeUpdate": true,
    "restartRequired": false
  }
}
```

2. **è®¾ç½®æ›´æ–°æœåŠ¡å™¨**ï¼š
   - éƒ¨ç½²æ›´æ–°æ£€æŸ¥æ¥å£
   - å‡†å¤‡æ›´æ–°åŒ…ä¸‹è½½
   - ç”Ÿæˆæ–‡ä»¶å“ˆå¸Œå€¼

3. **æ›´æ–°æ£€æŸ¥APIè¿”å›æ ¼å¼**ï¼š
```json
{
  "latestVersion": "1.1.0",
  "downloadUrl": "https://yourdomain.com/plugins/myplugin-v1.1.0.zip",
  "updateMode": "full",
  "fileSize": 1048576,
  "fileHash": "sha256:your-file-hash-here",
  "isForced": false,
  "releaseNotes": "æ–°ç‰ˆæœ¬æ›´æ–°è¯´æ˜",
  "releaseDate": "2024-12-24"
}
```

### æ›´æ–°åŒ…åˆ¶ä½œæµç¨‹

1. **æ„å»ºReleaseç‰ˆæœ¬**
2. **å‹ç¼©ä¸ºZIPæ–‡ä»¶**
3. **ç”Ÿæˆå“ˆå¸Œå€¼**ï¼š
```bash
# Windows PowerShell
Get-FileHash myplugin-v1.1.0.zip -Algorithm SHA256

# Linux/Mac
sha256sum myplugin-v1.1.0.zip
```
4. **ä¸Šä¼ åˆ°æœåŠ¡å™¨**
5. **æ›´æ–°æ¥å£è¿”å›ä¿¡æ¯**

## ğŸ› è°ƒè¯•æŠ€å·§

### 1. æ—¥å¿—è¾“å‡º
```csharp
private void LogDebug(string message)
{
    System.Diagnostics.Debug.WriteLine($"[DEBUG] {DateTime.Now:HH:mm:ss} - {message}");
}
```

### 2. å¼‚å¸¸å¤„ç†
```csharp
private T SafeExecute<T>(Func<T> action, T defaultValue = default(T))
{
    try
    {
        return action();
    }
    catch (Exception ex)
    {
        LogError($"æ“ä½œå¤±è´¥: {ex.Message}");
        ShowError($"æ“ä½œå¤±è´¥: {ex.Message}");
        return defaultValue;
    }
}
```

### 3. æ€§èƒ½ç›‘æ§
```csharp
private void MeasurePerformance(Action action, string operationName)
{
    var stopwatch = Stopwatch.StartNew();
    action();
    stopwatch.Stop();
    LogDebug($"{operationName} è€—æ—¶: {stopwatch.ElapsedMilliseconds}ms");
}
```

## ğŸ“¦ å‘å¸ƒéƒ¨ç½²

### 1. æ„å»ºReleaseç‰ˆæœ¬
- åˆ‡æ¢åˆ° Release é…ç½®
- æ¸…ç†è§£å†³æ–¹æ¡ˆ
- é‡æ–°ç”Ÿæˆè§£å†³æ–¹æ¡ˆ

### 2. æ‰“åŒ…æ’ä»¶
```
MyExcelPlugin/
â”œâ”€â”€ MyExcelPlugin.dll
â”œâ”€â”€ manifest.json
â”œâ”€â”€ README.md
â””â”€â”€ icon.png (å¯é€‰)
```

### 3. éƒ¨ç½²æ’ä»¶
å°†æ‰“åŒ…æ–‡ä»¶å¤åˆ¶åˆ°ï¼š
`DTI_Tool.AddIn\bin\Debug\Plugins\MyExcelPlugin\`

### 4. è®¾ç½®è‡ªåŠ¨æ›´æ–°ï¼ˆå¯é€‰ï¼‰
- å‡†å¤‡æ›´æ–°æœåŠ¡å™¨
- é…ç½®æ›´æ–°æ£€æŸ¥æ¥å£
- æµ‹è¯•æ›´æ–°æµç¨‹

## ğŸ’¡ æœ€ä½³å®è·µ

1. **é”™è¯¯å¤„ç†**: æ‰€æœ‰Excelæ“ä½œéƒ½è¦åŒ…è£…åœ¨try-catchä¸­
2. **èµ„æºé‡Šæ”¾**: åŠæ—¶é‡Šæ”¾COMå¯¹è±¡ï¼Œé¿å…å†…å­˜æ³„æ¼
3. **ç”¨æˆ·ä½“éªŒ**: æä¾›æ¸…æ™°çš„æ“ä½œæç¤ºå’Œé”™è¯¯ä¿¡æ¯
4. **æ€§èƒ½ä¼˜åŒ–**: æ‰¹é‡æ“ä½œæ—¶å…³é—­å±å¹•æ›´æ–°
5. **ä»£ç ç»„ç»‡**: æŒ‰åŠŸèƒ½æ¨¡å—ç»„ç»‡ä»£ç ï¼Œä¿æŒå•ä¸€èŒè´£
6. **ç‰ˆæœ¬ç®¡ç†**: åˆç†ä½¿ç”¨ç‰ˆæœ¬å·ï¼Œç»´æŠ¤æ›´æ–°æ—¥å¿—
7. **è‡ªåŠ¨æ›´æ–°**: ä¸ºæ’ä»¶é…ç½®è‡ªåŠ¨æ›´æ–°åŠŸèƒ½ï¼Œæå‡ç”¨æˆ·ä½“éªŒ

## ğŸ†˜ å¸¸è§é—®é¢˜

**Q: æ’ä»¶æ²¡æœ‰å‡ºç°åœ¨ExcelåŠŸèƒ½åŒºï¼Ÿ**
A: æ£€æŸ¥manifest.jsoné…ç½®ï¼Œç¡®ä¿æ’ä»¶æ­£ç¡®éƒ¨ç½²åˆ°Pluginsç›®å½•

**Q: è°ƒè¯•æ—¶Excelæ— æ³•å¯åŠ¨ï¼Ÿ**
A: æ£€æŸ¥Officeç‰ˆæœ¬å…¼å®¹æ€§ï¼Œç¡®ä¿å¼•ç”¨äº†æ­£ç¡®çš„Interopç‰ˆæœ¬

**Q: åŠŸèƒ½æ‰§è¡Œæ—¶æŠ¥é”™ï¼Ÿ**
A: æ·»åŠ å¼‚å¸¸å¤„ç†ï¼Œæ£€æŸ¥Excelå¯¹è±¡çš„çŠ¶æ€å’Œæƒé™

**Q: å¦‚ä½•æ·»åŠ è‡ªå®šä¹‰å›¾æ ‡ï¼Ÿ**
A: ä½¿ç”¨Officeå†…ç½®å›¾æ ‡ï¼ˆImageMsoï¼‰ï¼Œæˆ–æä¾›è‡ªå®šä¹‰å›¾ç‰‡æ–‡ä»¶

**Q: è‡ªåŠ¨æ›´æ–°ä¸å·¥ä½œï¼Ÿ**
A: æ£€æŸ¥updateUrlæ˜¯å¦æ­£ç¡®ï¼Œç¡®ä¿æ›´æ–°æœåŠ¡å™¨è¿”å›æ­£ç¡®çš„JSONæ ¼å¼

**Q: å¦‚ä½•ç”Ÿæˆæ–‡ä»¶å“ˆå¸Œå€¼ï¼Ÿ**
A: ä½¿ç”¨PowerShellçš„Get-FileHashå‘½ä»¤æˆ–Linuxçš„sha256sumå‘½ä»¤

Happy Coding! ğŸ‰ 